<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Задача 2. Ударная установка | Домашнее задание к лекции 1.2</title>
	<link rel="stylesheet" href="css/style.css">
</head>

<body>
	<ul class="drum-kit">
		<li class="drum-kit__drum key-clap" data-track="clap">
			<span class="drum-kit__drum__type">Clap</span>
		</li>
		<li class="drum-kit__drum key-hihat" data-track="hihat">
			<span class="drum-kit__drum__type">Hihat</span>
		</li>
		<li class="drum-kit__drum key-kick" data-track="kick">
			<span class="drum-kit__drum__type">Kick</span>
		</li>
		<li class="drum-kit__drum key-openhat" data-track="openhat">
			<span class="drum-kit__drum__type">Openhat</span>
		</li>
		<li class="drum-kit__drum key-boom" data-track="boom">
			<span class="drum-kit__drum__type">Boom</span>
		</li>
		<li class="drum-kit__drum key-ride" data-track="ride">
			<span class="drum-kit__drum__type">Ride</span>
		</li>
	</ul>

	<script>
		const allDrumElements = document.getElementsByClassName('drum-kit__drum');
		const playLog = [];
		let isPlayed = false;

		for (const drumElement of allDrumElements) {
			drumElement.addEventListener('click', (e) => {
				const track = e.target.dataset.track || e.target.parentElement.dataset.track;
				playLog.push(track);
			});
		}

		function observable() {
			if(playLog.length && !isPlayed) {
				isPlayed = true;
				const track = playLog.shift();
				const song = new Audio(`wav/${track}.wav`);
				song.play();
				song.addEventListener('ended', () =>  { 
					song.pause();
					song.removeAttribute('src');
					song.load();
					isPlayed = false;
				 });
			}
		}

		setTimeout(function observer() {
			observable();
			setTimeout(observer, 100);
		}, 2000);

	</script>
</body>

</html>